# Проектная работа "Веб-ларёк" 

## "Веб-ларёк" – это интернет-магазин товаров для веб-разработчиков. В нём можно:

- Просматривать каталог товаров.  
- Добавлять товары в корзину.  
- Оформлять заказ.  

## Стек:

- **Язык:** TypeScript  
- **Разметка и стили:** HTML, SCSS  
- **Сборщик:** Webpack  
- **Управление состоянием:** EventEmitter  
- **Архитектурный паттерн:** MVP (Model-View-Presenter)  
- **Документирование:** JSDoc

## Структура проекта:
- src/ — все исходные файлы проекта
- src/components/ — переиспользуемые JS-компоненты
- src/components/base/ — базовые абстрактные компоненты (например, BaseView)
- src/model/ — модели данных (работа с API, корзиной, товарами и заказами)
- src/view/ — отображение интерфейса и реакция на действия пользователя
- src/presenter/ — логика связывания моделей и представлений
- src/utils/ — вспомогательные функции, логгер и константы
- src/types/ — типизация (интерфейсы и типы данных)
- src/pages/ — HTML-шаблоны страниц
- src/scss/ — стили проекта
- src/public/ — статические ресурсы (изображения, шрифты и т.п.)

## Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/index.ts — точка входа приложения
- src/types/index.ts — центральный файл экспорта типов и моделей
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами
- src/view/modalView.ts - базовый класс для представления модального окна
- src/utils/logger.ts - утилита для логирования сообщений с разными уровнями важности
- webpack.config.js — конфигурация сборки проекта

## Описание архитектуры

Проект построен на паттерне MVP: логика и отображение разделены. Каждый компонент отвечает за одну задачу (SRP), модули общаются через EventEmitter, что делает архитектуру гибкой и масштабируемой.

### Основные компоненты

- **Model (Модели):** управляют данными и логикой обработки (товары, корзина, заказы).  

- **View (Представления):** отвечают за отрисовку интерфейса и реагируют на события.  

- **Presenter (Контроллеры):** связывают модели и представления, управляют логикой взаимодействий.  

- **EventEmitter:** используется для связи между компонентами.  

- **API-клиент:** получает данные с сервера и преобразует их в удобный формат.  

## Пример взаимодействия по MVP: оформление заказа
### Цель: пользователь выбирает способ оплаты и вводит адрес, чтобы перейти к следующему шагу оформления заказа.
1. View (PaymentModalView)
Пользователь кликает на кнопку способа оплаты или вводит адрес.
  - При клике на кнопку вызывается handlePaymentSelection, который эмиттит событие payment:method:selectet
  - При вводе адреса — событие payment:address:input
2. Presenter (PaymentPresenter)
Обрабатывает события:
  - Метод handlePaymentSelection сохраняет способ оплаты в модель Order
  - Метод handleAddressInput валидирует адрес и сохраняет в модель, обновляя состояние кнопки "Далее"
  - Если данные валидны, кнопка "Далее" активируется
3. Model (Order)
Модель заказа обновляет свои поля:
  - paymentMethod — выбранный метод
  - address — адрес доставки
  - Эти данные сохраняются в полях класса Order
4. Presenter (PaymentPresenter)
При клике на кнопку "Далее":
  - Проверяет, заполнены ли все поля
  - Если да — эмиттит событие order:step:complete, которое перехватывает OrderPresenter
5. View (ContactsModalView)
Презентер переключает отображение на следующий шаг — ContactsModalView с полями email и телефона. Пользователь продолжает оформление.

### Ключевые классы

#### Api (src/components/base)
- `catalogApi.ts` / `orderApi.ts` — взаимодействие с API

#### Модели (src/model)
- `productModel.ts` — данные товара, текущее превью
- `catalogModel.ts` — каталог продуктов, реализует хранение, фильтрацию и доступ к товарам
- `cartModel.ts` — управление корзиной (добавление, удаление, подсчёты)
- `orderModel.ts` — оформление заказа (почта, адрес, оплата)

#### Представления (src/view)
- `catalogView.ts` — отображение списка товаров
- `productView.ts` / `productModalView.ts` — карточки и модалки товаров
- `cartListView.ts` / `cartModalView.ts` — список и модальное окно корзины
- `contactsModalView.ts` — форма ввода email/телефона
- `paymentModalView.ts` — выбор способа оплаты и адреса
- `successModalView.ts` — окно успешного заказа
- `modalView.ts` — базовый модуль модального окна

#### Презентеры (src/presenter)
- `catalogPresenter.ts` — управление каталогом товаров
- `productModalPresenter.ts` — отображение карточки в модалке
- `cartPresenter.ts` — синхронизация корзины
- `paymentPresenter.ts` — управление шагом выбора способа оплаты
- `contactsPresenter.ts` — управление шагом с email/телефоном
- `orderPresenter.ts` — финализация заказа
- `successPresenter.ts` — показ финального окна


### Валидаторы и утилиты
- `utils.ts` — вспомогательные функции
- `constants.ts` — строковые и числовые константы
- `logger.ts` — логирование
- `productValidation.ts` — проверка данных заказа
- `orderValidation.ts` — регулярки для полей
- `validationUI.ts` — кастомное сообщение для регулярки

#### Типы данных (src/types)
- `product.ts` — описание товара
- `cart.ts` — структура корзины
- `order.ts` — данные заказа
- `modal.ts` — типы для модальных окон
- `catalog.ts` — данные каталога
- `index.ts` — корневой файл экспорта типов

## Документация
- docs/ - код проекта снабжён JSDoc-комментариями и самодокументируется

## Описание базовых классов
 
#### Класс Api (components/base/api.ts) 
##### Базовый класс для работы с API.
##### Методы:
- get(uri: string) — выполняет GET-запрос и возвращает данные в формате JSON.
- post(uri: string, data: object, method?: 'POST' | 'PUT' | 'DELETE') — отправка данных на сервер.
- handleResponse(response) — обрабатывает ответ сервера, включая ошибки.

#### Класс CatalogApi (model/catalogApi.ts)
##### Класс, реализующий загрузку и валидацию каталога товаров.  Использует Api для получения данных, ProductValidation — для фильтрации, и сохраняет валидные товары в Catalog.
##### Методы:
- getProducts(): Promise<Product[]> — загружает список продуктов с API, валидирует и сохраняет.
- getProductById(id: string): Product | undefined — возвращает один товар из локального каталога по ID.

#### Класс OrderApi (model/orderApi.ts)
##### Сервис для отправки заказа на сервер. Принимает данные заказа, валидирует наличие данных и использует Api для POST-запроса.
##### Методы:
- sendOrder(order: ICompletedOrder): Promise<object> — отправляет заказ на API и логирует результат.

#### Класс EventEmitter (components/base/events.ts)
##### Классическая реализация брокера событий на основе паттерна "Наблюдатель".
##### Методы:
- on(event, callback) — подписка на событие.
- off(event, callback) — отписка от события.
- emit(event, data) — вызов события.
- onAll(callback) — подписка на все события.
- offAll() — отписка от всех событий.
- trigger(eventName, context?) — возвращает функцию, которая вызывает событие с переданным контекстом.

#### Класс BaseView (utils/utils.ts - внутри файла)
##### Абстрактный класс представлений. Содержит универсальные методы работы с DOM, шаблонами и отображением.
##### Методы:
- cloneTemplate() — клонирует шаблон.
- qs(root, selector) — сокращённый метод поиска элементов.
- setImage(img, src, alt) — установка изображения.
- formatPrice(price) — форматирует цену (100 → "100 синапсов").
- show(element) / hide(element) — показать/скрыть элемент.
- bindEvents(element, events) — универсальный метод подписки на события.

#### Класс ModalView (view/modalView.ts)
##### Базовый класс для отображения модальных окон. Наследуется от BaseView.
##### Особенности:
- Принимает ID HTML-шаблона и рендерит его содержимое в контейнер #modal-container.
- Позволяет вставлять произвольные View в модальное окно через render(view).
- Поддерживает автоматическое закрытие по кнопке и фону.
##### Методы:
- render(view) — рендер представления в модалку.
- showModal() / hideModal() — показать/скрыть модалку.
- setupCloseHandlers() — вешает обработчики на .modal__close и фон.

## Описание классов Model

#### Класс Cart (cartModel.ts)
##### Модель корзины пользователя. Позволяет управлять товарами: добавлять, удалять, очищать и получать информацию.
##### Методы:
- getItems() — получить все товары.
- hasItem(id) — проверить наличие товара.
- addItem(product) — добавить товар.
- removeItem(id) — удалить товар.
- clear() — очистить корзину.
- getTotalCount() — количество товаров.
- getTotalPrice() — общая сумма заказа.

#### Класс Catalog (catalogModel.ts)
##### Каталог товаров. Хранит, фильтрует и предоставляет доступ к товарам.
##### Методы:
- getProducts() — получить список продуктов.
- setProducts(products) — установить и отфильтровать валидные продукты.
- getProductById(id) — найти продукт по ID.
- getAll() — вернуть весь каталог.

#### Класс Order (orderModel.ts)
##### Модель оформления заказа. Позволяет поэтапно накапливать данные и собрать финальный заказ.
##### Методы:
- setCart(items, total) — передать товары и сумму заказа.
- setAddress(address) — установить адрес доставки.
- setPaymentMethod(method) — выбрать способ оплаты.
- setContacts(email, phone) — установить контакты.
- isComplete() — проверить полноту данных.
- getData() — собрать заказ в структуру ICompletedOrder.
- reset() — сбросить заказ.

#### Класс Product (productModel.ts)
##### Модель полного продукта.
##### Конструктор принимает:
- id — идентификатор
- title — название
- description — описание
- price — цена (может быть null)
- category — категория
- image — ссылка на изображение

## Описание классов View

#### Класс CartListView (cartListView.ts)
##### Представление для отображения списка товаров в корзине. Не является модальным — встраивается прямо в контейнер страницы.
##### Методы:
- render(items: ICartItem[], total: number): void
Отрисовывает корзину: список товаров, общую сумму, кнопку оформления. Применяет шаблоны, обновляет DOM и добавляет обработчики.
- onRemove(handler: (id: string) => void): void
Назначает обработчик удаления товара из корзины по кнопке basket__item-delete.
- onCheckout(handler: () => void): void
Назначает обработчик на кнопку «Оформить заказ».
- updateCounter(count: number): void
Обновляет счётчик товаров в иконке корзины (.header__basket-counter).

#### Класс CartModalView (cartModalView.ts)
##### Модальное представление корзины, расширяет функциональность базового ModalView.
##### Методы:
- getContentElement(): HTMLElement
Возвращает DOM-элемент .modal__content — основную область модального окна, куда можно вставлять представление корзины (CartListView).
##### Конструктор:
- Принимает cdnUrl — ссылку на внешние ресурсы
- Передаёт ID шаблона 'basket' и CDN в базовый ModalView

#### Класс CatalogView (catalogView.ts)
##### Отвечает за отображение карточек товаров в основном каталоге. Используется как основное представление на главной странице.
##### Методы:
- render(products: ICatalogProduct[]): void
Отображает список карточек товаров, очищая контейнер и добавляя элементы, созданные через createCard.
- clear(): void
Очищает DOM-контейнер от ранее отрендеренных карточек.
- createCard(product: ICatalogProduct): HTMLElement
Создаёт DOM-элемент карточки товара, назначает обработчики кликов и классы по категории. Эмиттит событие product:select при клике.
##### Конструктор:
- container — элемент, в который рендерится каталог
- events — объект событий, используется для отправки событий (например, при клике на товар)

#### Класс ContactsModalView (contactsModalView.ts)
##### Модальное представление формы ввода email и телефона. Предоставляет доступ к DOM-элементам формы, управление состоянием кнопки и очистку полей.
##### Методы:
- getElement(): HTMLElement
Возвращает DOM-элемент модального окна. Инициализирует и кэширует форму, поля и кнопку при первом вызове.
- reset(): void
Удаляет сохранённый DOM-элемент, чтобы пересоздать его при следующем вызове getElement().
- resetFields(): void
Очищает значения полей email и phone, отключает кнопку отправки.
- setSubmitEnabled(enabled: boolean): void
Включает или отключает кнопку отправки формы.

- getEmailInput(): - поле ввода емеила
- getPhoneInput(): поле ввода телефона
- getSubmitButton(): кнопка отправки формы
##### Конструктор:
- Загружает шаблон template#contacts
- Инициализирует форму, email, phone и submit-кнопку

#### Класс PaymentModalView (paymentModalView.ts)
##### Модальное окно для выбора способа оплаты и ввода адреса доставки. Отвечает за отображение формы и доступ к её элементам.
##### Методы:
- getElement(): HTMLElement
Создаёт и возвращает DOM-элемент формы, инициализируя поля, кнопки и submit-кнопку.
- reset(): void
Удаляет кэшированный DOM — при следующем рендере элемент будет пересоздан.
- resetFields(): void
Сбрасывает значения полей ввода и состояния кнопок, но не пересоздаёт DOM.
- setNextButtonEnabled(enabled: boolean): void
Активирует или деактивирует кнопку "Далее" (submit).
- getSelectedPaymentMethod(): string \| null
Возвращает name активной кнопки способа оплаты, либо null, если ничего не выбрано.

- getPaymentButtons() — массив кнопок способов оплаты
- getAddressInput() — поле ввода адреса
- getNextButton() — кнопка отправки формы
##### Конструктор:
- Загружает шаблон template#order, инициализирует форму и её элементы

#### Класс ProductModalView (productModalView.ts)
##### Модальное окно для отображения карточки товара в полном виде. Объединяет ModalView и ProductView для визуализации детальной информации о продукте.
##### Методы:
- update(product: IFullProduct & { hasCart: boolean }): void
Отображает товар в модальном окне, перерисовывая карточку через ProductView. Содержимое модалки полностью очищается перед отрисовкой.
- isVisible(): boolean
Проверяет, открыто ли модальное окно (по классу modal_active).
- close(): void
Закрывает окно и очищает содержимое .modal__content.
##### Конструктор:
- events — объект событий для передачи в ProductView
- cdnUrl — путь к изображениям и другим ресурсам

#### Класс ProductView (productView.ts)
##### Класс для отображения одной карточки товара. Используется в каталоге, а также в модальном окне (ProductModalView). Отвечает за рендеринг и реакцию на клики.
##### Методы:
- render(product: IFullProduct & { hasCart: boolean }): HTMLElement
Генерирует карточку товара и устанавливает обработчик кнопки добавления/удаления из корзины. Эмиттит cart:add или cart:remove.
- updateButton(button, hasCart)
Обновляет текст кнопки в зависимости от состояния товара в корзине.
##### Конструктор:
- Принимает объект событий events и сохраняет его для отправки взаимодействий
- Использует шаблон #card-preview — выбрасывает ошибку, если не найден

#### Класс SuccessModalView (successModalView.ts)
##### Модальное окно, отображающее сообщение об успешном оформлении заказа и итоговую сумму. Также содержит кнопку закрытия.
##### Методы:
- getElement(): HTMLElement
Возвращает DOM-элемент модального окна, инициализирует внутренние элементы (.order-success__description, .order-success__close) при первом вызове.
- reset(): void
Удаляет сохранённый DOM, чтобы пересоздать окно при следующем вызове getElement().
- setTotal(total: number): void
Устанавливает текст итоговой суммы в блок .order-success__description с форматированием (Списано 1 200 синапсов).
- getCloseButton(): HTMLButtonElement
Возвращает кнопку закрытия модального окна.
##### Конструктор:
- Загружает шаблон #success

## Описание классов Presenter

#### Класс CartPresenter (cartPresenter.ts)
##### Презентер для корзины. Связывает модель Cart, представления CartListView и CartModalView, а также управляет взаимодействием через глобальный EventEmitter.
##### Методы:
- subscribeToEvents()
Подписывается на глобальные события:
  - cart:add — добавление товара в корзину
  - cart:remove — удаление товара
  - cart:open — открытие модального окна корзины и вызов рендера
- mountListeners()
  Навешивает UI-обработчики на CartListView:
  - onRemove(id) — удаление товара через UI
  - onCheckout() — эмиттит order:open с содержимым корзины
- render()
Синхронизирует модель и представление: обновляет список товаров, общую стоимость и счётчик корзины.
##### Конструктор:
- Инициализирует презентер и вызывает подписку на события.

#### Класс CatalogPresenter (catalogPresenter.ts)
##### Презентер каталога продуктов. Отвечает за загрузку и отображение товаров, обработку выбора товара и повторный рендер каталога по событию.
##### Методы:
- async init(): Promise<void>
Загружает продукты с сервера, сохраняет в локальный Catalog, отображает список и подписывается на события. Логирует результат.
- bindEvents(): void
  Обрабатывает два события:
  - product:select — находит продукт по ID, эмиттит modal:open с флагом hasCart
  - catalog:open — повторно рендерит список товаров
- renderCatalog(): void
Получает список всех товаров, дополняет их флагом hasCart, передаёт в CatalogView.
##### Конструктор:
Создаёт экземпляр с представлением, моделью, корзиной и системой событий. Локально инициализирует Catalog.

#### Класс ContactsPresenter (contactsPresenter.ts)
##### Презентер второго шага оформления заказа — ввода email и телефона. Отвечает за инициализацию формы, валидацию полей, отображение ошибок и завершение шага.
##### Методы:
- init(): void
  Инициализирует форму:
  - Подписывается на событие order:reset для сброса полей
##### Конструктор:
- Создаёт презентер, связывающий модель заказа с формой ввода контактов. Устанавливает обработку событий, валидацию и завершение шага при успешной отправке.

#### Класс OrderPresenter (orderPresenter.ts)
##### Презентер, управляющий процессом оформления заказа. Связывает шаги выбора оплаты, ввода контактов и отображения успешного оформления. Контролирует переход между шагами, отправку заказа и сброс состояния.
##### Методы:
- setup(): void
Подписка на событие order:open. Инициализирует модель заказа и запускает первый шаг — PaymentPresenter.
- onPaymentComplete(): void
Переход ко второму шагу — отображение формы контактов и запуск ContactsPresenter.
- onContactsComplete({ email, phone }): Promise<void>
Сохраняет контакты в модель, собирает заказ и отправляет его через API. В случае успеха — показывает финальный экран.
- showSuccess(total: number): void
Создаёт SuccessPresenter, отображает SuccessModalView, запускает его.
- onSuccessClose(): void
Закрывает модалку, сбрасывает модель заказа, очищает корзину, сбрасывает состояния всех шагов. 
  Эмиттит события: 
  - order:reset
  - cart:changed 
  - catalog:open
##### Конструктор:
Создаёт цепочку из трёх презентеров (оплата → контакты → успех), подключает представления к модалке и настраивает начальную подписку.

#### Класс PaymentPresenter (paymentPresenter.ts)
##### Презентер первого шага оформления заказа — выбора способа оплаты и ввода адреса доставки. Обрабатывает пользовательский ввод, управляет валидацией и активирует переход к следующему шагу.
##### Методы:
- init(): void
  Инициализирует интерфейс:
  - Навешивает события на кнопки оплаты, поле адреса и кнопку "Далее"
  - Обрабатывает переход к следующему шагу
  - Подписывается на order:reset для очистки полей
- handlePaymentSelection(button): void
Обновляет визуальное состояние выбранной кнопки, сохраняет метод в модель и проверяет, можно ли активировать кнопку "Далее".
- handleAddressInput(): void
Валидирует введённый адрес, показывает сообщение об ошибке и сохраняет корректный адрес в модель.
- updateNextButtonState(): void
Проверяет валидность адреса и наличие выбранного способа оплаты, включает/выключает кнопку "Далее".
- bindEvents(): void
Подписка на order:reset — вызывает resetFields() у PaymentModalView.
##### Конструктор:
Настраивает шаг оплаты: связывает модель, представление, событие завершения и глобальные события.

#### Класс ProductModalPresenter (productModalPresenter.ts)
##### Презентер модального окна товара. Отвечает за отображение карточки товара, валидацию данных и синхронизацию состояния кнопки "В корзину" при изменении содержимого корзины.
##### Методы:
Подписка на события:
  - modal:open — валидирует товар, обновляет и отображает модальное окно с товаром
  - cart:changed — синхронизирует кнопку "В корзину" (текущее состояние)
- private updateView(): void
Обновляет содержимое модалки и флаг hasCart, если окно открыто. Перерисовывает товар с актуальным состоянием.
##### Конструктор:
Создаёт презентер, подписывается на глобальные события, связывает модальное окно товара и корзину.

#### Класс SuccessPresenter (SuccessPresenter.ts)
##### Презентер финального шага оформления заказа. Отвечает за отображение итоговой суммы и обработку закрытия окна после успешной покупки.
##### Методы:
- init(): void
Устанавливает сумму в представление, отображает сообщение об успехе и навешивает обработчик на кнопку закрытия. При клике вызывает onClose().
##### Конструктор:
Создаёт презентер успешного оформления, передаёт итоговую сумму и колбэк закрытия.

## Валидация данных

#### Валидация продукта (utils/productValidation.ts)
Каждый товар при загрузке из API валидируется по следующим правилам:
- title — обязательное поле, не должно быть пустым.
- price — либо:
  - число больше 0 (валидно),
  - либо null (тоже валидно, такой товар считается «бесценным» и кнопка добавления в корзину будет заблокирована).
Tакие товары отображаются, но не могут быть куплены — реализуется блокировка кнопки в ProductView.

#### Валидация полей формы (utils/validators.ts)
Форма заказа валидирует следующие поля:
Email
- Паттерн: /^[^\s@]+@[^\s@]+\.[^\s@]+$/
- Проверяет корректность email без пробелов, с @ и доменной зоной.
- Примеры валидных: test@example.com, john.doe@domain.org
Телефон
Паттерн: /^\+?\d{10,15}$/
- Поддерживает международный формат (с +), от 10 до 15 цифр.
- Примеры валидных: +79001234567, 89991234567
Адрес доставки
- Паттерн: /^[a-zA-Zа-яА-ЯёЁ0-9\s,.-]{5,}$/
- Разрешены буквы (русские и латинские), цифры, пробелы, запятые, точки, дефисы.
- Минимум 5 символов, без верхнего ограничения.
- Пример: ул. Ленина, 25, 123 Main St.

#### Отображение ошибок (utils/validationUI.ts)
Для отображения ошибок валидации используется встроенный механизм браузера — кастомные сообщения через setCustomValidity.
Функция updateValidationUI принимает:
- поле ввода (input: HTMLInputElement),
- результат валидации (isValid: boolean),
- текст сообщения об ошибке (message: string).
Такой подход позволяет не внедрять собственный UI ошибок, а использовать нативную валидацию браузера с кастомными текстами.

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
